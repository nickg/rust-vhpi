name: Run dumper example
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      - name: Set up Rust
        uses: actions-rust-lang/setup-rust-toolchain@1780873c7b576612439a134613cc4cc74ce5538c # v1.15.2
        with:
          rust-version: stable
      - uses: nickg/setup-nvc@v1
        with:
          version: latest
      - name: Build project
        run: cargo build
      - name: Build VHDL code - simple example
        run: |
          nvc -a test_examples/tb_simple.vhdl
          nvc -e tb_simple
      - name: Run VHDL simulation - simple example
        run: nvc -r tb_simple --load=target/debug/libdumper.so
      - name: Build VHDL code - string example
        run: |
          nvc -a test_examples/tb_string.vhdl
          nvc -e tb_string
      - name: Run VHDL simulation - string example
        run: nvc -r tb_string --load=target/debug/libdumper.so
      - name: Build VHDL code - numeric array example
        run: |
          nvc -a test_examples/tb_arrays.vhdl
          nvc -e tb_arrays
      - name: Run VHDL simulation - numeric array example
        run: nvc -r tb_arrays --load=target/debug/libdumper.so
      - name: Build VHDL code - enum example
        run: |
          nvc -a test_examples/tb_enums.vhdl
          nvc -e tb_enums
      - name: Run VHDL simulation - enum example
        run: nvc -r tb_enums --load=target/debug/libdumper.so
      - name: Build VHDL code - physical time example
        run: |
          nvc -a test_examples/tb_physical_time.vhdl
          nvc -e tb_physical_time
      - name: Run VHDL simulation - physical time example
        run: nvc -r tb_physical_time --load=target/debug/libdumper.so
      - name: Build VHDL code - complex example
        run: |
          nvc -a test_examples/tb_complex.vhdl
          nvc -e tb_complex
      - name: Run VHDL simulation - complex example
        run: nvc -r tb_complex --load=target/debug/libdumper.so
